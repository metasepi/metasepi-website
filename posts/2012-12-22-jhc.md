---
title: 簡約!λカ娘(4)の紹介とjhcのすゝめ
description: かわいい(小さい)バイナリは正義でゲソ!
tags: haskell, book, compiler
---

この記事は
[Debian/Ubuntu JP Advent Calendar 2012 : ATND](http://atnd.org/events/34386)
と
[Haskell Advent Calendar 2012](http://partake.in/events/45a01d39-af5e-42f1-91c7-e8fcc91db244)
の12/22(土曜)分記事でゲソー。

またもや
[関数型プログラミングの本](http://www.paraiso-lang.org/ikmsm/books/c83.html)
が出るでゲソ。コミックマーケット83
[3日目 東地区 Y-02a](http://twitcmap.jp/?id=0083-3-YYa-02-a)
で頒布予定なので、みんな買ってほしいでゲソ!

![](http://www.paraiso-lang.org/ikmsm/images/c83-cover-s.jpg)

* 第1章 インターフェース
* 第2章 Lighter than Light # <= コレ書いた
* 第3章 類は友を呼ぶ?
* 第4章 OCaml で printf じゃなイカ?
* 第5章 Haskell でも printf じゃなイカ?!
* 第6章 けいさん! highschool

がもくじで、
[@master_q](https://twitter.com/master_q)
は第2章を書いたらしいでゲソ。
この章ではHaskellで書かれたフィボナッチ数列のみを表示する
プログラムをどこまで小さくできるか、GHCを改造することで挑戦しているゲソ。
記事が気になったら是非
[サンプル版pdf](http://www.paraiso-lang.org/ikmsm/books/c83-sample.pdf)
を読んでみてほしいでゲッソ!


## Haskellコンパイラjhc

GHCの話はこの本に力いっぱい書いたので、
今日はまた別のHaskellコンパイラの話をしようと思うでゲソ。
HaskellのコンパイラにはGHC以外にも
[実装がある](http://www.haskell.org/haskellwiki/Implementations)
んでゲソ。
その中でもワシが注目しているのは
[jhc](http://repetae.net/computer/jhc/)
でゲソ。

### インストール

まずはインストールしてみるでゲソ。
この記事での想定環境はDebian GNU/Linux sid amd64 2012年12月22日時点でゲソ。

~~~
$ sudo apt-get install autotools-dev autoconf libwww-perl drift ghc libghc-readline-dev libghc-utf8-string-dev libghc-hssyck-dev libghc-fgl-dev libghc-zlib-dev libghc-regex-compat-dev libghc-random-dev libreadline-dev libncurses5-dev darcs
$ darcs get http://repetae.net/repos/jhc
$ darcs log|head -2 
Wed Mar 14 07:58:54 UTC 2012  John Meacham <john@repetae.net>
  * fix 'distcheck', include compat/ in tarball
$ autoreconf -i
$ ./configure
$ make
$ sudo make install
$ jhc --version
jhc 0.8.1 (0.8.0-59)
compiled by ghc-7.4 on a x86_64 running linux
~~~

簡単にインストールできたじゃなイカ。

### jhcの威力を見よ!

ためしに簡単なプログラムをコンパイルして、GHCとjhcの比較をしてみなイカ？

~~~
$ cat Fib.hs
fibonacci :: [Int]
fibonacci = 1:1:zipWith (+) fibonacci (tail fibonacci)
main :: IO ()
main = print $ take 40 fibonacci
$ ghc -o Fib_ghc Fib.hs
$ jhc -o Fib_jhc Fib.hs
$ size Fib_ghc Fib_jhc
   text    data     bss     dec     hex filename
 705068   38536   46776  790380   c0f6c Fib_ghc
  15808    1300     744   17852    45bc Fib_jhc
$ ldd Fib_ghc Fib_jhc
Fib_ghc:
        linux-vdso.so.1 (0x00007fffaadff000)
        libgmp.so.10 => /usr/lib/x86_64-linux-gnu/libgmp.so.10 (0x00007f671ef83000)
        libffi.so.5 => /usr/lib/x86_64-linux-gnu/libffi.so.5 (0x00007f671ed76000)
        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f671ea7b000)
        librt.so.1 => /lib/x86_64-linux-gnu/librt.so.1 (0x00007f671e873000)
        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f671e66f000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f671e2c6000)
        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f671e0aa000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f671f22a000)
Fib_jhc:
        linux-vdso.so.1 (0x00007fff1ef3b000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f39020b3000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f3902493000)
~~~

なんと!
同じソースコードをコンパイルしたのに、jhcはGHCの1/40のバイナリサイズでゲソ。
しかもjhcの吐き出した実行バイナリの依存ライブラリはlibcのみ。
これはどんな魔法なんでゲソ？

### jhcの持つ可能性

-Cオプションの話とか。

xxx

## Debianパッケージ化

2012年12月22日(土)時点ではまだ本家には登録完了していないでゲソが、
[anonscm.debian.org Git - collab-maint/jhc.git](http://anonscm.debian.org/gitweb/?p=collab-maint/jhc.git)
からソースパッケージを取得できるでゲソ。

xxx
